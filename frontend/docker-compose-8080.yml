services:
  algodiscovery-frontend:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        BUILD_ENV: prod:8080
    container_name: algodiscovery-frontend-prod
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=production
      - PORT=8080
      - HOSTNAME=algodiscovery.prod
    volumes:
      # Mount logs for debugging
      - ./logs:/var/log/nginx
    # Use host networking for better localhost access
    network_mode: host
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "com.algodiscovery.service=frontend"
      - "com.algodiscovery.environment=production"
      - "com.algodiscovery.version=1.0.0"
      - "com.algodiscovery.hostname=algodiscovery.prod"

volumes:
  nginx-logs:
    driver: local
